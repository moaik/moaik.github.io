<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>ElementUI日期组件格式化问题 | Moaik</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="vue," />
  

  <meta name="description" content="最近做一个CMS管理系统，采用前后端分离模式。由于前端开发人员排不开期，所以只好我们PHP自己写页面。对于我这样一个连Jqery都不会写的初级码农，突然要求用vue写页面，着实困难不小。一脸懵逼…两脸懵逼…虽然写起来磕磕绊绊，但最后还是如期完工了。至此，我总结了两点，先说重要的。新接触任何一个事物，心态要摆正，一定不能产生抵触心理。再然后是充分理解新事物的核心理念，vue的核心是数据双向绑定。 到">
<meta name="keywords" content="vue">
<meta property="og:type" content="article">
<meta property="og:title" content="ElementUI日期组件格式化问题">
<meta property="og:url" content="https://moaik.github.io/vue-element-ui-date-picker-format/index.html">
<meta property="og:site_name" content="Moaik">
<meta property="og:description" content="最近做一个CMS管理系统，采用前后端分离模式。由于前端开发人员排不开期，所以只好我们PHP自己写页面。对于我这样一个连Jqery都不会写的初级码农，突然要求用vue写页面，着实困难不小。一脸懵逼…两脸懵逼…虽然写起来磕磕绊绊，但最后还是如期完工了。至此，我总结了两点，先说重要的。新接触任何一个事物，心态要摆正，一定不能产生抵触心理。再然后是充分理解新事物的核心理念，vue的核心是数据双向绑定。 到">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-12-10T18:26:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ElementUI日期组件格式化问题">
<meta name="twitter:description" content="最近做一个CMS管理系统，采用前后端分离模式。由于前端开发人员排不开期，所以只好我们PHP自己写页面。对于我这样一个连Jqery都不会写的初级码农，突然要求用vue写页面，着实困难不小。一脸懵逼…两脸懵逼…虽然写起来磕磕绊绊，但最后还是如期完工了。至此，我总结了两点，先说重要的。新接触任何一个事物，心态要摆正，一定不能产生抵触心理。再然后是充分理解新事物的核心理念，vue的核心是数据双向绑定。 到">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  

  

  

  


  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            归档
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/categories/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
    </ul>
  </div>


</div>




<div class="content content-post CENTER">
   <article id="post-vue-element-ui-date-picker-format" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">ElementUI日期组件格式化问题</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.11.30</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>moaik</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/编程/">编程</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>最近做一个CMS管理系统，采用前后端分离模式。由于前端开发人员排不开期，所以只好我们PHP自己写页面。对于我这样一个连Jqery都不会写的初级码农，突然要求用vue写页面，着实困难不小。一脸懵逼…两脸懵逼…虽然写起来磕磕绊绊，但最后还是如期完工了。至此，我总结了两点，先说重要的。新接触任何一个事物，心态要摆正，一定不能产生抵触心理。再然后是充分理解新事物的核心理念，vue的核心是数据双向绑定。</p>
<p>到最后，功能虽然实现了，但小问题还有很多。这里就说说ElementUI日期组件的的坑以及解决方法。关于问题描述，已经有人提出<a href="https://github.com/ElemeFE/element/issues/1841" target="_blank" rel="noopener">issue</a>，详情可以参考这个<a href="https://github.com/ElemeFE/element/issues/1841" target="_blank" rel="noopener">issue</a>。</p>
<p>这里再描述下问题是怎么产生的和如何解决的。Date对象使用UTC时间，比北京时间慢8小时。ElementUI的日期组件会在展示的时候自动将UTC时间转成本地时间，但model仍是UTC时间。可以脑补一副撕逼画面：运营找开发说，我特么的明明选择了这个活动的上线时间是2018年1月1日08时00分00秒，现在都特么中午了，怎么还没自动上线？然后，后端开发查查数据库发现这个活动的实际开始时间是2018年1月1日16时00分00秒。后端找前端问，是不是你给我传错时间了……</p>
<p>现在问题就出在这慢了的8小时。如果前端是个可爱的小妹妹，她会求后端开发在保存到数据库之前处理一下她传过来的这个时间。后端开发乐呵呵地去改了。如果前端是个满脸胡子的大老爷们儿……老爷们儿心里说一句妈卖批，然后自己改。满脸胡子的前端一边写如下代码一边心里说，多大点事儿啊！老子分分钟搞定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let date = this.createDate;</span><br><span class="line">date = [</span><br><span class="line">  [date.getFullYear(), date.getMonth() + 1, date.getDate()].join(&apos;-&apos;),</span><br><span class="line">  [date.getHours(), date.getMinutes(), date.getSeconds()].join(&apos;:&apos;)</span><br><span class="line">].join(&apos; &apos;).replace(/(?=\b\d\b)/g, &apos;0&apos;);</span><br><span class="line">this.createDate = date;</span><br></pre></td></tr></table></figure>
<p>上边代码能把UTC时间处理成北京时间，但也把时间对象变成了时间字符串。看起来没毛病，但其实有毛病，在vue里就会有毛病。我们假设<code>this.createDate</code>是日期控件绑定的值，起初它是一个对象，在传给后端之前做了时区转换，这个绑定的值也从对象变成了字符串。双向绑定、双向绑定、双向绑定，所以转换之后的<code>this.createDate</code>已经不是对象了。当再次提交表单就会提示找不到<code>getFullYear</code>这个方法。</p>
<p>解决这个问题其实非常简单，我们不要直接改变绑定的这个日期控件的值。在传给后端之前，新定义一个变量<code>let dateTemp</code>，把双向绑定的<code>this.createDate</code>赋值给新定义变量。然后转换<code>dateTemp</code>为正确时区。</p>
<p>有添加的地方就有编辑，所以在获取数据之后先要把时间字符串转换成对象，然后再赋值给绑定的<code>this.createDate</code>。即:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.createDate = new Date(Date.parse(timestamp.replace(/-/g, &quot;/&quot;)))</span><br></pre></td></tr></table></figure>

    
  </div>
</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">不用支持</span>
      <div class="donation-body">
        <div class="tip text-center">去掉样式就乱了</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/left.jpg" alt="">
          </li>
        
          <li class="item">
            <img src="/images/left.jpg" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/custom-logger-in-laravel5-5/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/mac-sublime-handle-column/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              归档
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/categories/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
